title: About Maven
date: 2016-09-09 12:30:00
tags: maven

---

## 序

Maven 是什么？ 

>  一种工具。 

工具又是用来干嘛的呢？

>  用来解决目前大家遇到的一些共性的、复杂的、耗时的问题。

任何一种工具的出现都是有原因的, 那么, Maven 又是用来解决哪些问题的呢？



![title_pic](http://7xjzby.com1.z0.glb.clouddn.com/menu-restaurant-vintage-tab.jpg)

<!-- more -->

## 过去

### 目录结构

在过去，我们新建项目时，需要添加项目的源码目录 `src`，包目录 `lib`，资源目录 `WebRoot/WebContent/web` 等等.

![web 源码目录](http://7xjzby.com1.z0.glb.clouddn.com/blog_maven_intro_web_src_dir.png)

我们可以发现， 不同项目的目录结构，各有各的风格。

这就会让我们在接触一个新的项目时，感到困惑。也不利于初学者的入门。

> 不同的源码目录， 不同的 web 资源目录，散落的 jar ，都会在项目构建初期带来比较大的麻烦

### jar 依赖

目录结构搭建完成后，我们往往还需要去不同的网站上下载项目所需要依赖的各种 jar 包。

>  spring-2.5.6.jar、junit-4.9.jar etc..
>
>  找 jar 包这个过程很痛苦， 做过的人都应该有所了解。 

在这个过程中， 我们需要找到合适的版本比如 aspectjrt-1.5.1.jar， 合适的依赖包 aspectjweaver-1.5.1.jar。
多个 jar 包之间版本要兼容等等相关的问题。比如 spring-2.5.6.jar 需要依赖 slf4j-1.3.jar， 而 MyBatis 可能需要依赖 slf4j-1.5.jar。这个时候还需要解决重复依赖的问题， 选择一个更兼容的版本。

jar 包找齐之后， 我们还需要把对于 jar 包的依赖，添加到项目的类路径依赖配置中「eg. `.classpath/.idea`」，不同的 IDE 下对于类路径的依赖也是不同的

> 比较有经验的工程师可能都会维护一个自己的 jar 库， 当然， jar 包的版本比较老也是难免的。
>
> 如果有必要，我们往往还需要下载项目的源码包，并导入到 IDE 环境中，IDE 源码配置也是相当烦人的一个操作

总而言之，解决 jar 包的依赖，是传统的项目开发中一项不容忽视的工作。

### VersionControl

在最终的版本库「`svn/git`」中，除了项目必要的源码，可能还会包含各种 jar 包以及 classpath 之类相关 IDE 配置。

> jar 包都可以当做是现有类库，理论上没有必要出现在项目之中
>
> 而 IDE 相关配置作为开发环境自身的配置，更不应该作为项目的一部分被版本管理工具管理起来

### Summary

目前来看，传统的项目开发，至少有三个比较不好的地方：

1. 项目目录结构的生成，没有规范；
2. 和 jar 包相关的管理，依赖问题；
3. 在版本库中包含了过多与项目自身无关的内容；

## 现在

那么，Maven 是又通过哪些方式解决了这些烦人的问题呢？

Maven 使用惯例优于配置的原则。

它要求在没有定制之前，所有的项目都有如下的结构： 

| 目录                            | 目的                              |
| :---------------------------- | ------------------------------- |
| ${basedir}                    | 存放 pom.xml和所有的子目录               |
| ${basedir}/src/main/java      | 项目的 java源代码                     |
| ${basedir}/src/main/resources | 项目资源，如各种配置文件                    |
| ${basedir}/src/test/java      | 项目的测试类，比如说 JUnit代码              |
| ${basedir}/src/test/resources | 测试使用的资源                         |
| ${basedir}/src/main/webapp    | 存放所有的 Web 资源, 比如 WEB-INF, 静态资源等 |

> ${basedir} : 项目根目录

Maven 为什么要使用惯例优于配置的原则？
一方面，统一项目结构，降低大家看到新项目时的学习成本；
另一方面，方便我们直接进行使用；

> 演示 Maven 新建项目, 展示默认约定的目录结构
>
> 引入 pom & mvn 项目常用的生命周期
>
> 引入 介绍 .m2 目录下的 .settings & repository



Maven 提供了一种方式， 让每一个组件都可以拥有自己的 location 坐标。
groupId + articleId + version + [type]。
eg.  `org.springframework.spring-mvc-3.2.2.jar`

```xml
<dependency>
    <groupId>org.springframework</groupId>
    <artifactId>spring-mvc</artifactId>
    <version>3.2.2</version>
</dependency>
```
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-mvc</artifactId>
        <version>3.2.2</version>
    </dependency>


通过在项目中配置所需依赖包的 location， 我们就可以让项目自动依赖所需的 jar 包。
jar 包之间所有的依赖关系， maven 会自动进行处理。当然我们可以通过手工修改配置的方式来制定不同的依赖版本， 但大多数情况下是不必要的。 


## 场景

不知道大家过去有没有开发过存在多个项目依赖的 Web应用。 

假如， 现在有这样一个场景， 公司 C 有多个项目组， 其中有架构组（F） 负责缓存 日志等公用服务，基础资源组（B） - 有系统公用资源层的开发 负责用户 角色 资源的基础服务， Web 应用开发组（W） - 负责最终的商业项目开发， 还有负责不同业务线的开发小组。 

现在， 我们的系统架构是这样

Web 应用 1
业务组件 A | 业务组件 B 
基础资源组件 
架构组件


Web 应用 2
业务组件 A | 业务组件 C
基础资源组件 
架构组件

上面是公司的技术部架构

接下来，说一下项目的具体场景

我们的 Web 应用 1， 假设目前的  Release 版本号是 2.0.   它所依赖的架构组件， 版本号是 0.1. 
现在因为发现了一个安全问题， 版本号要更新到最新的  0.2.

传统的步骤：
	1. 架构组 打包项目， F-0.2.jar
	2. 把打包好的组件发给其他项目组， 并通知其他项目组， 替换 组件
	3. 所有涉及到的项目，备份 F-0.1.jar , 升级到 F-0.2.jar ， 如果 F-0.2.jar 有了新的依赖 比如 aspect.jar， 那么我们的项目中也需要导入它所依赖的 jar 包
	> 解决jar 包依赖问题一直都是很烦人的问题
	4. 测试 - 如果组件 A 存在问题， 重复 1 - 4 步
	5. 发布项目

Maven：
	1. 修改项目版本号， deploy 到 maven 私有仓库（存放 jar 包的地方）
	2. 邮件通知到相关项目组， 更新版本号
	3. 涉及到的项目更新组件版本号
	4. 测试 - 如果组件出现问题， 重复执行  deploy，通知相关人员，测试 即可， 不需要不断的发包给别人 也无需解决 jar 依赖的问题
	5. 发布项目


## 介绍

Maven 是一个项目管理 & 构建自动化工具。
它有很强大的依赖管理功能， 可以帮助我们简化项目之间的依赖关系。


### 依赖管理 

怎么理解呢？

对于 Java 项目来讲， 每一个项目都会或多或少的依赖一些 jar 包。 
而每个 jar 其实都是一个已经发布的项目。也就是说我们的项目其实已经依赖了各种各样的项目， 比如 Spring，Hibernate etc.. 
从另一个角度来讲，这也就意味着，我们可以通过maven， 把所有的 jar 包(项目)管理起来。

QA


### 项目管理

那么，我们既然可以通过 Maven 引用别人的项目，那么是不是意味着我们自己的项目，如果是由多个子项目来构成，那也可以通过 Maven 来组织呢？


多项目之间的依赖， 首先 第一个问题，就是我们需要通过 IDE 的项目依赖配置， 来解决开发过程中不断打 jar 包来构建依赖的问题。
第二个就是依赖版本的控制， 这个怎么理解呢？比如 我们的 Web 应用的版本是 1.0， 而所依赖某个组件， 比如组件 A 的版本可能是 0.1。 组件 A 由专门的开发组来维护。 
随着时间的推移， 我们的Web 应用可能升级到了 2.3， 而组件因为一直稳定所以还是0.1.  有一天突然有一个安全问题， 导致所有应用的组件 A 都需要升级到 0.5。
步骤：
​	






### 构建自动化

> 

maven 的生命周期指项目的构建过程，它包含了一系列有序的阶段


## Maven 的优势

